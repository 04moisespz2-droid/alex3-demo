<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Configuraci√≥n - ALEX 3.0</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body class="dashboard-body">

  <!-- Sidebar igual que el resto -->
  <div class="sidebar">
    <h2 class="logo">ALEX 3.0</h2>
    <ul class="menu">
      <li><a href="dashboard.html">üè† Inicio</a></li>
      <li><a href="inventario.html">üì¶ Inventario</a></li>
      <li><a href="ventas.html">üíµ Ventas</a></li>
      <li><a href="caja.html">üí∞ Caja</a></li>
      <li><a href="usuarios.html">üë§ Usuarios</a></li>
      <li><a href="reportes.html">üìä Reportes</a></li>
      <li class="active"><a href="configuracion.html">‚öôÔ∏è Configuraci√≥n</a></li>
    </ul>
  </div>

  <div class="main-content">
    <h1>‚öôÔ∏è Configuraci√≥n de ALEX 3.0</h1>
    <p>Administra las opciones generales del sistema.</p>

    <!-- BLOQUE: Moneda del sistema -->
    <div class="settings-box">
      <h2>üíµ Moneda del sistema</h2>
      <label for="monedaSistema">Moneda principal que usar√°n los precios del sistema:</label>
      <select id="monedaSistema" onchange="guardarMonedaSistema()">
        <option value="GTQ">GTQ ‚Äì Quetzal (Guatemala)</option>
        <option value="MXN">MXN ‚Äì Peso mexicano</option>
        <option value="USD">USD ‚Äì D√≥lar estadounidense</option>
        <option value="COP">COP ‚Äì Peso colombiano</option>
        <option value="PEN">PEN ‚Äì Sol peruano</option>
        <option value="CLP">CLP ‚Äì Peso chileno</option>
        <option value="BRL">BRL ‚Äì Real brasile√±o</option>
        <option value="ARS">ARS ‚Äì Peso argentino</option>
      </select>
      <p id="monedaSistemaInfo" style="margin-top:6px; font-size:0.9rem; color:#ccc;"></p>
    </div>

    <!-- BLOQUE: Respaldos -->
    <div class="settings-box">
      <h2>üóÇÔ∏è Respaldos del sistema</h2>
      <p style="font-size:0.9rem; color:#ccc;">Exporta o importa todos los datos guardados en este navegador.</p>
      <button onclick="exportarRespaldoALEX3()">üíæ Exportar respaldo</button>
      <button onclick="document.getElementById('archivoRespaldoALEX3').click()">üìÇ Importar respaldo</button>
      <input type="file" id="archivoRespaldoALEX3" accept="application/json" style="display:none"
             onchange="importarRespaldoALEX3(this.files[0])">
    </div>

    <!-- BLOQUE: Restaurar -->
    <div class="settings-box">
      <h2>‚ö†Ô∏è Restaurar ALEX 3.0</h2>
      <p style="font-size:0.9rem; color:#ccc;">
        Esta opci√≥n borra todos los datos guardados (inventario, ventas, caja, usuarios, etc.) en este navegador.
      </p>
      <button onclick="restaurarFabrica()">üîÑ Restaurar a f√°brica</button>
    </div>

    <p style="margin-top:24px; font-size:0.85rem; color:#777;">
      ALEX 3.0 ‚Äî Configuraci√≥n general (moneda, respaldos y restauraci√≥n).
    </p>
  </div>

  <script>
    // ==========================
    // MONEDA DEL SISTEMA (CONFIG)
    // ==========================
    const MONEDAS_SISTEMA = {
      GTQ: { simbolo: "Q", nombre: "Quetzal (Guatemala)", sufijo: "" },
      MXN: { simbolo: "$", nombre: "Peso mexicano", sufijo: " MXN" },
      USD: { simbolo: "$", nombre: "D√≥lar estadounidense", sufijo: " USD" },
      COP: { simbolo: "$", nombre: "Peso colombiano", sufijo: " COP" },
      PEN: { simbolo: "S/", nombre: "Sol peruano", sufijo: "" },
      CLP: { simbolo: "$", nombre: "Peso chileno", sufijo: " CLP" },
      BRL: { simbolo: "R$", nombre: "Real brasile√±o", sufijo: "" },
      ARS: { simbolo: "$", nombre: "Peso argentino", sufijo: " ARS" }
    };

    function cargarMonedaSistema() {
      const sel = document.getElementById("monedaSistema");
      if (!sel) return;

      let codigo = localStorage.getItem("alex3_moneda_sistema") || "GTQ";
      if (!MONEDAS_SISTEMA[codigo]) codigo = "GTQ";

      sel.value = codigo;
      actualizarTextoMoneda();
    }

    function guardarMonedaSistema() {
      const sel = document.getElementById("monedaSistema");
      const codigo = sel.value;
      localStorage.setItem("alex3_moneda_sistema", codigo);
      actualizarTextoMoneda();
      alert("‚úÖ Moneda del sistema actualizada.");
    }

    function actualizarTextoMoneda() {
      const info = document.getElementById("monedaSistemaInfo");
      if (!info) return;

      let codigo = localStorage.getItem("alex3_moneda_sistema") || "GTQ";
      if (!MONEDAS_SISTEMA[codigo]) codigo = "GTQ";

      const m = MONEDAS_SISTEMA[codigo];
      info.textContent =
        `Moneda actual: ${m.simbolo} (${m.nombre}). Todos los precios se consideran en esta moneda.`;
    }

    // ==========================
    // RESPALDOS Y RESTAURAR
    // (estas funciones estar√°n en alex-storage.js, pero
    // si ya las tienes ah√≠, puedes borrarlas de aqu√≠)
    // ==========================

    function exportarRespaldoALEX3() {
      try {
        const data = {};
        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          const value = localStorage.getItem(key);
          data[key] = value;
        }
        const blob = new Blob([JSON.stringify(data, null, 2)], {
          type: "application/json",
        });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "alex3-respaldo.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        alert("‚úÖ Respaldo generado correctamente.");
      } catch (error) {
        console.error("Error al exportar respaldo:", error);
        alert("‚ùå Ocurri√≥ un error al exportar el respaldo.");
      }
    }

    function importarRespaldoALEX3(file) {
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function (event) {
        try {
          const contenido = event.target.result;
          const data = JSON.parse(contenido);
          if (typeof data !== "object" || data === null) {
            alert("‚ùå El archivo no tiene un formato v√°lido.");
            return;
          }
          localStorage.clear();
          Object.keys(data).forEach((key) => {
            localStorage.setItem(key, data[key]);
          });
          alert("‚úÖ Respaldo importado correctamente. Recarga la p√°gina.");
          location.reload();
        } catch (error) {
          console.error("Error al importar respaldo:", error);
          alert("‚ùå Ocurri√≥ un error al importar el respaldo.");
        }
      };
      reader.readAsText(file);
    }

    function restaurarFabrica() {
      if (confirm("¬øSeguro? Perder√°s todos los datos guardados en este navegador.")) {
        localStorage.clear();
        alert("‚úÖ ALEX 3.0 restaurado a f√°brica.");
        location.reload();
      }
    }

    window.addEventListener("load", cargarMonedaSistema);
  </script>

</body>
</html>
