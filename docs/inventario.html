<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Inventario - ALEX 3.0</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body class="dashboard-body">

  <div class="sidebar">
    <h2 class="logo">ALEX 3.0</h2>
    <ul class="menu">
      <li id="menu-dashboard"><a href="dashboard.html">ğŸ  Inicio</a></li>
      <li id="menu-inventario"><a href="inventario.html">ğŸ“¦ Inventario</a></li>
      <li id="menu-ventas"><a href="ventas.html">ğŸ’µ Ventas</a></li>
      <li id="menu-caja"><a href="caja.html">ğŸ’° Caja</a></li>
      <li id="menu-usuarios"><a href="usuarios.html">ğŸ‘¤ Usuarios</a></li>
      <li id="menu-reportes"><a href="reportes.html">ğŸ“Š Reportes</a></li>
    </ul>
  </div>

  <div class="main-content">
    <h1>Inventario</h1>

    <div class="inventario-form">
      <h3>Agregar producto</h3>

      <input id="codigo" class="input" type="text" placeholder="CÃ³digo del producto">
      <input id="nombre" class="input" type="text" placeholder="Nombre del producto">
      <input id="compra" class="input" type="number" step="0.01" placeholder="Precio de compra">
      <input id="venta" class="input" type="number" step="0.01" placeholder="Precio de venta">
      <input id="stock" class="input" type="number" step="1" placeholder="Stock inicial">

      <button class="btn" onclick="agregarProducto()">Agregar</button>
    </div>

    <table class="tabla">
      <thead>
        <tr>
          <th>CÃ³digo</th>
          <th>Nombre</th>
          <th>Compra</th>
          <th>Venta</th>
          <th>Ganancia</th>
          <th>Margen (%)</th>
          <th>Stock</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="tabla-body"></tbody>
    </table>

  </div>

  <script src="alex-storage.js"></script>
  <script src="alex-dev.js"></script>
  <script src="alex-roles.js"></script>

  <script>
    const usuarioActual = getUsuarioActualObligatorio();
    aplicarPermisosYProteger("inventario");

    let productos = load("productos", []);

    function formatearMoneda(n) {
      return alex3FormatearMoneda(n);
    }

    function agregarProducto() {
      const codigo = document.getElementById("codigo").value.trim();
      const nombre = document.getElementById("nombre").value.trim();
      const compra = parseFloat(document.getElementById("compra").value);
      const venta = parseFloat(document.getElementById("venta").value);
      const stock = parseInt(document.getElementById("stock").value);

      if (!codigo || !nombre || isNaN(compra) || isNaN(venta) || isNaN(stock)) {
        alert("Por favor completa todos los campos con valores vÃ¡lidos.");
        return;
      }

      const ganancia = venta - compra;
      const margen = compra > 0 ? ((ganancia / compra) * 100).toFixed(1) : "0.0";

      const nuevo = { codigo, nombre, compra, venta, ganancia, margen, stock };
      productos.push(nuevo);

      save("productos", productos);
      limpiarFormulario();
      renderTabla();
    }

    function limpiarFormulario() {
      document.getElementById("codigo").value = "";
      document.getElementById("nombre").value = "";
      document.getElementById("compra").value = "";
      document.getElementById("venta").value = "";
      document.getElementById("stock").value = "";
      document.getElementById("codigo").focus();
    }

    function renderTabla() {
      const tbody = document.getElementById("tabla-body");
      tbody.innerHTML = "";

      productos.forEach((p, index) => {
        tbody.innerHTML += `
          <tr>
            <td>${p.codigo}</td>
            <td>${p.nombre}</td>
            <td>${formatearMoneda(p.compra)}</td>
            <td>${formatearMoneda(p.venta)}</td>
            <td>${formatearMoneda(p.ganancia)}</td>
            <td>${p.margen}%</td>
            <td>${p.stock}</td>
            <td><button onclick="eliminarProducto(${index})">ğŸ—‘ï¸</button></td>
          </tr>
        `;
      });
    }

    function eliminarProducto(index) {
      if (!confirm("Â¿Eliminar este producto del inventario?")) return;
      productos.splice(index, 1);
      save("productos", productos);
      renderTabla();
    }

    // Inicializar tabla al cargar
    renderTabla();
  </script>

</body>
</html>
