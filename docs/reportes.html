<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reportes - ALEX 3.0</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body class="dashboard-body">

  <div class="sidebar">
    <h2 class="logo">ALEX 3.0</h2>
    <ul class="menu">
      <li id="menu-dashboard"><a href="dashboard.html"> Inicio</a></li>
      <li id="menu-inventario"><a href="inventario.html"> Inventario</a></li>
      <li id="menu-ventas"><a href="ventas.html"> Ventas</a></li>
      <li id="menu-caja"><a href="caja.html"> Caja</a></li>
      <li id="menu-usuarios"><a href="usuarios.html"> Usuarios</a></li>
      <li id="menu-reportes"><a href="reportes.html"> Reportes</a></li>
      <li id="menu-configuracion"><a href="configuracion.html">锔 Configuraci贸n</a></li>
    </ul>
  </div>

  <div class="main-content">
    <h1>Reportes generales</h1>

    <!-- RESUMEN PRINCIPAL -->
    <div class="resumen-caja">
      <div class="card-resumen">
        <h4>Total de productos</h4>
        <p><span id="rep-total-productos">0</span></p>
      </div>
      <div class="card-resumen">
        <h4>Stock total</h4>
        <p><span id="rep-stock-total">0</span></p>
      </div>
      <div class="card-resumen ingreso">
        <h4>Ingresos caja (hist贸rico)</h4>
        <p><span id="rep-total-ingresos">0.00</span></p>
      </div>
      <div class="card-resumen egreso">
        <h4>Egresos caja (hist贸rico)</h4>
        <p><span id="rep-total-egresos">0.00</span></p>
      </div>
      <div class="card-resumen saldo">
        <h4>Saldo actual estimado</h4>
        <p><span id="rep-saldo-actual">0.00</span></p>
      </div>
    </div>

    <!-- INVENTARIO -->
    <h2>Inventario (resumen)</h2>
    <p>Listado r谩pido de productos registrados en el sistema.</p>
    <table class="tabla">
      <thead>
        <tr>
          <th>C贸digo</th>
          <th>Nombre</th>
          <th>Compra</th>
          <th>Venta</th>
          <th>Ganancia</th>
          <th>Margen (%)</th>
          <th>Stock</th>
        </tr>
      </thead>
      <tbody id="tabla-inventario-reporte"></tbody>
    </table>

    <!-- MOVIMIENTOS DE CAJA -->
    <h2>Movimientos de caja</h2>
    <p>Historial de ingresos y egresos registrados en la caja profesional.</p>
    <table class="tabla">
      <thead>
        <tr>
          <th>Fecha/Hora</th>
          <th>Tipo</th>
          <th>Categor铆a</th>
          <th>Descripci贸n</th>
          <th>Monto</th>
        </tr>
      </thead>
      <tbody id="tabla-movimientos-reporte"></tbody>
    </table>

    <!-- CIERRES DE CAJA -->
    <h2>Cierres de caja</h2>
    <p>Resumen de cada cierre registrado.</p>
    <table class="tabla">
      <thead>
        <tr>
          <th>Fecha/Hora</th>
          <th>Saldo al cierre</th>
          <th>Observaciones</th>
        </tr>
      </thead>
      <tbody id="tabla-cierres-reporte"></tbody>
    </table>

  </div>

  <script src="alex-storage.js"></script>
  <script src="alex-dev.js"></script>
  <script src="alex-roles.js"></script>

  <script>
    const usuarioActual = getUsuarioActualObligatorio();
    aplicarPermisosYProteger("reportes");

    function formatearMoneda(n) {
      return alex3FormatearMoneda(n);
    }

    // Cargar datos guardados
    const productos = load("productos", []);
    const movimientos = load("movimientosCaja", []);
    const saldoInicial = load("saldoInicial", 0);
    const cierres = load("cierresCaja", []);

    // ===== RESUMEN PRINCIPAL =====
    function calcularResumen() {
      const totalProductos = productos.length;
      const stockTotal = productos.reduce((acc, p) => acc + (p.stock || 0), 0);

      let totalIngresos = 0;
      let totalEgresos = 0;

      movimientos.forEach(m => {
        if (m.tipo === "ingreso") totalIngresos += m.monto;
        else if (m.tipo === "egreso") totalEgresos += m.monto;
      });

      const saldoActual = saldoInicial + totalIngresos - totalEgresos;

      document.getElementById("rep-total-productos").innerText = totalProductos;
      document.getElementById("rep-stock-total").innerText = stockTotal;
      document.getElementById("rep-total-ingresos").innerText = formatearMoneda(totalIngresos);
      document.getElementById("rep-total-egresos").innerText = formatearMoneda(totalEgresos);
      document.getElementById("rep-saldo-actual").innerText = formatearMoneda(saldoActual);
    }

    // ===== TABLA DE INVENTARIO =====
    function renderInventario() {
      const tbody = document.getElementById("tabla-inventario-reporte");
      tbody.innerHTML = "";

      productos.forEach(p => {
        tbody.innerHTML += `
          <tr>
            <td>${p.codigo}</td>
            <td>${p.nombre}</td>
            <td>${formatearMoneda(p.compra)}</td>
            <td>${formatearMoneda(p.venta)}</td>
            <td>${formatearMoneda(p.ganancia)}</td>
            <td>${p.margen}%</td>
            <td>${p.stock}</td>
          </tr>
        `;
      });
    }

    // ===== TABLA DE MOVIMIENTOS DE CAJA =====
    function renderMovimientos() {
      const tbody = document.getElementById("tabla-movimientos-reporte");
      tbody.innerHTML = "";

      movimientos.forEach(m => {
        tbody.innerHTML += `
          <tr>
            <td>${m.fecha}</td>
            <td>${m.tipo === "ingreso" ? "Ingreso" : "Egreso"}</td>
            <td>${m.categoria || ""}</td>
            <td>${m.descripcion}</td>
            <td>${formatearMoneda(m.monto)}</td>
          </tr>
        `;
      });
    }

    // ===== TABLA DE CIERRES DE CAJA =====
    function renderCierres() {
      const tbody = document.getElementById("tabla-cierres-reporte");
      tbody.innerHTML = "";

      cierres.forEach(c => {
        tbody.innerHTML += `
          <tr>
            <td>${c.fecha}</td>
            <td>${formatearMoneda(c.saldoFinal)}</td>
            <td>${c.observaciones}</td>
          </tr>
        `;
      });
    }

    // Inicializar p谩gina de reportes
    calcularResumen();
    renderInventario();
    renderMovimientos();
    renderCierres();
  </script>

</body>
</html>
