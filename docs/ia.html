<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>ALEX 3.0 - IA Empresarial</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body class="dashboard-body">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <span class="logo-badge">A</span>
      <div class="sidebar-logo-text">
        <span class="sidebar-logo-main">ALEX 3.0</span>
        <span class="sidebar-logo-sub">Panel del negocio</span>
      </div>
    </div>

    <nav class="sidebar-nav">
      <a href="dashboard.html" class="sidebar-link">ğŸ“Š Dashboard</a>
      <a href="ventas.html" class="sidebar-link">ğŸ’µ Ventas</a>
      <a href="inventario.html" class="sidebar-link">ğŸ“¦ Inventario</a>
      <a href="caja.html" class="sidebar-link">ğŸ’° Caja</a>
      <a href="compras.html" class="sidebar-link">ğŸ§¾ Compras</a>
      <a href="gastos.html" class="sidebar-link">ğŸ“‰ Gastos</a>
      <a href="clientes.html" class="sidebar-link">ğŸ‘¥ Clientes</a>
      <a href="proveedores.html" class="sidebar-link">ğŸšš Proveedores</a>
      <a href="contabilidad.html" class="sidebar-link">ğŸ“š Contabilidad</a>
      <a href="sat.html" class="sidebar-link">ğŸ‡¬ğŸ‡¹ SAT Guatemala</a>
      <a href="ia.html" class="sidebar-link active">ğŸ¤– IA empresarial</a>
      <a href="configuracion.html" class="sidebar-link">âš™ï¸ ConfiguraciÃ³n</a>
    </nav>

    <div class="sidebar-footer">
      <span class="sidebar-footer-title">Empresa demo</span>
      <span class="sidebar-footer-sub">VersiÃ³n 1.0</span>
    </div>
  </aside>

  <!-- Layout principal -->
  <div class="main-layout">
    <!-- Topbar -->
    <header class="topbar">
      <button class="btn-menu-mobile" id="btnMenuMobile">â˜°</button>

      <div class="topbar-left">
        <h1 class="topbar-title">IA empresarial de ALEX 3.0</h1>
        <p class="topbar-subtitle">
          Alertas inteligentes, simulaciones y decisiones automÃ¡ticas para tu negocio.
        </p>
      </div>

      <div class="topbar-right">
        <span class="topbar-company">Mi tienda demo</span>
        <span class="topbar-divider">â€¢</span>
        <span class="topbar-user" id="topbar-user-label">Usuario (Rol)</span>
        <button class="btn" id="btnLogout" type="button" style="margin-left: 0.75rem;">
          Cerrar sesiÃ³n
        </button>
      </div>
    </header>

    <!-- Contenido principal -->
    <main class="main-content">
      <!-- QuÃ© harÃ¡ la IA -->
      <section class="cards-grid">
        <article class="card">
          <h2 class="card-title">Alertas inteligentes</h2>
          <p class="card-description">
            ALEX 3.0 analizarÃ¡ tus datos de forma automÃ¡tica y te avisarÃ¡ cuando algo importante estÃ© pasando.
          </p>
          <ul class="alerts-list">
            <li class="alert-item">ğŸ”” <strong>Stock bajo:</strong> productos que se estÃ¡n quedando sin inventario.</li>
            <li class="alert-item">ğŸ”” <strong>DÃ­as flojos:</strong> ventas muy bajas comparadas con el promedio.</li>
            <li class="alert-item">ğŸ”” <strong>Fiados peligrosos:</strong> clientes con saldo muy alto o atrasado.</li>
            <li class="alert-item">ğŸ”” <strong>Caja sospechosa:</strong> diferencias entre sistema y efectivo fÃ­sico.</li>
          </ul>
        </article>

        <article class="card">
          <h2 class="card-title">Recomendaciones automÃ¡ticas</h2>
          <p class="card-description">
            La IA no solo mostrarÃ¡ nÃºmeros, tambiÃ©n te dirÃ¡ quÃ© hacer con ellos.
          </p>
          <ul class="alerts-list">
            <li class="alert-item">ğŸ’¡ Subir o bajar precios segÃºn margen y competencia.</li>
            <li class="alert-item">ğŸ’¡ Recordatorios para cobrar fiados o pagar a proveedores.</li>
            <li class="alert-item">ğŸ’¡ Sugerencias de combos y productos que mÃ¡s se venden.</li>
            <li class="alert-item">ğŸ’¡ Metas de venta diarias y semanales basadas en tu historial.</li>
          </ul>
        </article>

        <article class="card">
          <h2 class="card-title">SAT e impuestos (IA)</h2>
          <p class="card-description">
            Con tus datos de ventas, compras y gastos, ALEX podrÃ¡ explicarte tus impuestos en lenguaje sencillo.
          </p>
          <ul class="alerts-list">
            <li class="alert-item">ğŸ“Œ Estimar cuÃ¡nto debes pagar cada mes.</li>
            <li class="alert-item">ğŸ“Œ Explicar por quÃ© subiÃ³ o bajÃ³ tu impuesto.</li>
            <li class="alert-item">ğŸ“Œ Simular escenarios: â€œÂ¿quÃ© pasa si vendo el doble?â€.</li>
            <li class="alert-item">ğŸ“Œ Prepararte para el siguiente cambio de rÃ©gimen.</li>
          </ul>
        </article>
      </section>

      <!-- Simulador rÃ¡pido (ya funcional en el navegador) -->
      <section class="card">
        <h2 class="card-title">Simulador rÃ¡pido de utilidad diaria</h2>
        <p class="card-description">
          Ingresa tus ventas, costos y gastos para que ALEX calcule una utilidad estimada y tu margen de ganancia.
        </p>

        <div class="form-grid">
          <div class="form-field">
            <label for="simVentas">Ventas del dÃ­a (Q)</label>
            <input id="simVentas" class="input" type="number" step="0.01" min="0" placeholder="Ej: 800.00">
          </div>

          <div class="form-field">
            <label for="simCostos">Costo de mercancÃ­a (Q)</label>
            <input id="simCostos" class="input" type="number" step="0.01" min="0" placeholder="Ej: 350.00">
          </div>

          <div class="form-field">
            <label for="simGastos">Gastos del dÃ­a (Q)</label>
            <input id="simGastos" class="input" type="number" step="0.01" min="0" placeholder="Ej: 120.00 (envÃ­os, luz, etc.)">
          </div>
        </div>

        <button class="btn" id="btnSimular">Calcular utilidad</button>

        <div style="margin-top: 1.5rem;">
          <h3 class="card-title">Resultado de la simulaciÃ³n</h3>
          <table class="table">
            <tbody>
              <tr>
                <th>Ventas</th>
                <td id="simResVentas">Q 0.00</td>
              </tr>
              <tr>
                <th>Costos + gastos</th>
                <td id="simResCostosGastos">Q 0.00</td>
              </tr>
              <tr>
                <th>Utilidad estimada</th>
                <td id="simResUtilidad">Q 0.00</td>
              </tr>
              <tr>
                <th>Margen sobre ventas</th>
                <td id="simResMargen">0.00 %</td>
              </tr>
            </tbody>
          </table>
          <p class="card-description" id="simComentario">
            Ingresa los datos y presiona en â€œCalcular utilidadâ€ para ver una interpretaciÃ³n rÃ¡pida.
          </p>
        </div>
      </section>

      <!-- Futuras automatizaciones -->
      <section class="card">
        <h2 class="card-title">Ideas de automatizaciÃ³n futura</h2>
        <p class="card-description">
          Algunas acciones que ALEX 3.0 podrÃ¡ hacer por ti de manera automÃ¡tica cuando se conecte a la nube:
        </p>
        <ul class="alerts-list">
          <li class="alert-item">ğŸ¤– Enviar un resumen diario a tu WhatsApp o correo con ventas, gastos y caja.</li>
          <li class="alert-item">ğŸ¤– Recordarte cuÃ¡ndo hacer pedidos a proveedores segÃºn el inventario.</li>
          <li class="alert-item">ğŸ¤– Sugerir quÃ© productos promocionar en redes segÃºn los mÃ¡s vendidos.</li>
          <li class="alert-item">ğŸ¤– Avisarte si algÃºn empleado registra movimientos raros en caja.</li>
        </ul>
      </section>
    </main>
  </div>

  <!-- Scripts base -->
  <script src="alex-storage.js"></script>
  <script src="alex-roles.js"></script>

  <script>
    // MenÃº mÃ³vil
    const btnMenuMobile = document.getElementById('btnMenuMobile');
    const sidebar = document.querySelector('.sidebar');

    if (btnMenuMobile) {
      btnMenuMobile.addEventListener('click', () => {
        sidebar.classList.toggle('sidebar-open');
      });
    }

    // Usuario y permisos
    const usuarioActual = typeof getUsuarioActualObligatorio === "function"
      ? getUsuarioActualObligatorio()
      : null;

    if (typeof aplicarPermisosYProteger === "function") {
      aplicarPermisosYProteger("ia");
    }

    // Mostrar nombre y rol
    const labelUser = document.getElementById("topbar-user-label");
    if (usuarioActual && labelUser) {
      const rolTexto = usuarioActual.rol === "dueno" ? "DueÃ±o" : "Empleado";
      labelUser.textContent = `${usuarioActual.nombre} (${rolTexto})`;
    }

    // Cerrar sesiÃ³n
    const btnLogout = document.getElementById("btnLogout");
    if (btnLogout) {
      btnLogout.addEventListener("click", () => {
        if (!confirm("Â¿Quieres cerrar sesiÃ³n?")) return;

        if (typeof save === "function") {
          save("usuarioActual", null);
        } else {
          localStorage.removeItem("usuarioActual");
        }

        window.location.href = "index.html";
      });
    }

    // Helper de moneda
    function alex3FormatearMonedaLocal(valor) {
      const num = Number(valor);
      if (isNaN(num)) return "Q 0.00";
      return "Q " + num.toFixed(2);
    }

    // LÃ³gica del simulador
    function calcularSimulacion() {
      const ventas = parseFloat(document.getElementById("simVentas").value) || 0;
      const costos = parseFloat(document.getElementById("simCostos").value) || 0;
      const gastos = parseFloat(document.getElementById("simGastos").value) || 0;

      const totalCostosGastos = costos + gastos;
      const utilidad = ventas - totalCostosGastos;
      const margen = ventas > 0 ? (utilidad / ventas) * 100 : 0;

      document.getElementById("simResVentas").textContent = alex3FormatearMonedaLocal(ventas);
      document.getElementById("simResCostosGastos").textContent = alex3FormatearMonedaLocal(totalCostosGastos);
      document.getElementById("simResUtilidad").textContent = alex3FormatearMonedaLocal(utilidad);
      document.getElementById("simResMargen").textContent = margen.toFixed(2) + " %";

      const comentario = document.getElementById("simComentario");
      if (utilidad < 0) {
        comentario.textContent = "âš ï¸ EstÃ¡s en pÃ©rdida en esta simulaciÃ³n. Revisa precios, costos o gastos.";
      } else if (margen < 10) {
        comentario.textContent = "âš ï¸ EstÃ¡s ganando muy poco. Tu margen es bajo, podrÃ­as ajustar precios o bajar gastos.";
      } else if (margen >= 10 && margen < 30) {
        comentario.textContent = "âœ… Margen aceptable. PodrÃ­as mejorar un poco tus precios o buscar proveedores mÃ¡s baratos.";
      } else {
        comentario.textContent = "ğŸ”¥ Excelente margen. Tu negocio tiene buena rentabilidad con estos nÃºmeros.";
      }
    }

    const btnSimular = document.getElementById("btnSimular");
    if (btnSimular) {
      btnSimular.addEventListener("click", calcularSimulacion);
    }
  </script>
</body>
</html>
